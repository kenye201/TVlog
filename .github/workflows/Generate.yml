name: Generate M3U Playlist

on:
  push:
    branches:
      - main
  workflow_dispatch:  # 支持手动触发

jobs:
  generate_m3u:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'

    - name: Install dependencies
      run: |
        pip install requests

    - name: Run Python script to generate M3U
      run: |
        python md/test22.py  # 根据你的脚本实际路径修改

    - name: Check if demo_output.m3u exists
      run: |
        if [ -f demo_output.m3u ]; then
          echo "✅ demo_output.m3u exists"
        else
          echo "❌ demo_output.m3u not found!"
          exit 1  # 如果文件不存在，工作流会失败
        fi

    - name: Upload demo_output.m3u as artifact
      uses: actions/upload-artifact@v4
      with:
        name: demo_output
        path: demo_output.m3u  # 确保路径正确

    - name: Check and upload missing_logos.txt if exists
      run: |
        if [ -f missing_logos.txt ]; then
          echo "✅ missing_logos.txt exists"
          # Upload the file
          actions/upload-artifact@v4:
            name: missing_logos
            path: missing_logos.txt
        else
          echo "❌ missing_logos.txt not found"
        fi

    - name: Check and upload tvbox_output.txt if exists
      run: |
        if [ -f tvbox_output.txt ]; then
          echo "✅ tvbox_output.txt exists"
          # Upload the file
          actions/upload-artifact@v4:
            name: tvbox_output
            path: tvbox_output.txt
        else
          echo "❌ tvbox_output.txt not found"
        fi
