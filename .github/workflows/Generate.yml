name: Generate M3U Playlist

on:
  push:
    branches:
      - main
  workflow_dispatch:  # 支持手动触发

jobs:
  generate_m3u:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'

    - name: Install dependencies
      run: |
        pip install requests

    - name: Run Python script to generate M3U
      run: |
        python md/test22.py  # 根据你的脚本实际路径修改

    - name: Check if demo_output.m3u exists
      run: |
        if [ -f demo_output.m3u ]; then
          echo "✅ demo_output.m3u exists"
          cat demo_output.m3u
        else
          echo "❌ demo_output.m3u not found!"
        fi

    - name: Upload demo_output.m3u as artifact
      uses: actions/upload-artifact@v4
      with:
        name: demo_output
        path: demo_output.m3u  # 确保路径正确

    - name: Upload missing_logos.txt if exists
      if: success() && (exists('missing_logos.txt'))
      uses: actions/upload-artifact@v4
      with:
        name: missing_logos
        path: missing_logos.txt

    - name: Upload tvbox_output.txt if exists
      if: success() && (exists('tvbox_output.txt'))
      uses: actions/upload-artifact@v4
      with:
        name: tvbox_output
        path: tvbox_output.txt
